<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no">
<title>0rkUS Task - Full Featured</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0a;--card:#141414;--accent:#6366f1;--text:#e8e8e8;--muted:#666;--success:#10b981;--danger:#ef4444}
body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Display',sans-serif;background:var(--bg);color:var(--text);padding:0 0 80px;overflow-x:hidden}
.lang{position:fixed;top:12px;right:12px;z-index:9999;background:rgba(99,102,241,0.15);backdrop-filter:blur(20px);border-radius:20px;padding:8px;display:flex;gap:6px;box-shadow:0 4px 20px rgba(0,0,0,0.3)}
.lang button{padding:8px 14px;border:none;border-radius:12px;background:rgba(255,255,255,0.05);color:#fff;cursor:pointer;font-size:13px;font-weight:600;transition:all .3s}
.lang button:hover{background:rgba(255,255,255,0.1);transform:translateY(-2px)}
.lang button.active{background:var(--accent);box-shadow:0 4px 12px rgba(99,102,241,0.4)}
.header{background:linear-gradient(135deg,#6366f1 0%,#4f46e5 50%,#4338ca 100%);padding:28px 20px;border-radius:0 0 36px 36px;margin-top:56px;position:relative;overflow:hidden}
.header::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:radial-gradient(circle,rgba(255,255,255,0.1) 1px,transparent 1px);background-size:24px 24px;animation:slidePattern 20s linear infinite}
@keyframes slidePattern{0%{transform:translate(0,0)}100%{transform:translate(24px,24px)}}
.greeting{font-size:28px;font-weight:800;margin-bottom:8px;position:relative;z-index:1}
.subtitle{font-size:14px;opacity:0.9;position:relative;z-index:1}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;padding:0 16px;margin-top:-32px;position:relative;z-index:2}
.stat{background:linear-gradient(145deg,rgba(20,20,20,0.95),rgba(30,30,30,0.9));backdrop-filter:blur(30px);border:1px solid rgba(99,102,241,0.2);border-radius:20px;padding:20px 12px;text-align:center;box-shadow:0 8px 24px rgba(0,0,0,0.3);transition:all .3s}
.stat:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(99,102,241,0.3);border-color:var(--accent)}
.stat-val{font-size:26px;font-weight:800;background:linear-gradient(135deg,#6366f1,#818cf8,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:6px}
.stat-label{font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;font-weight:600}
.page{display:none;padding:16px}
.page.active{display:block;animation:fadeIn .3s}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.section-title{font-size:22px;font-weight:700;margin:24px 0 16px;display:flex;align-items:center;gap:10px}
.section-title::before{content:'';width:4px;height:24px;background:var(--accent);border-radius:2px}
.glass{background:linear-gradient(145deg,rgba(20,20,20,0.7),rgba(30,30,30,0.6));backdrop-filter:blur(30px);border:1px solid rgba(255,255,255,0.08);border-radius:24px;padding:24px;margin-bottom:16px;box-shadow:0 8px 32px rgba(0,0,0,0.3);transition:all .3s}
.glass:hover{border-color:rgba(99,102,241,0.3);box-shadow:0 12px 40px rgba(99,102,241,0.2)}
.btn{padding:16px 24px;border-radius:16px;border:none;background:linear-gradient(135deg,#6366f1,#4f46e5);color:#fff;font-weight:700;cursor:pointer;width:100%;font-size:15px;transition:all .3s;box-shadow:0 4px 16px rgba(99,102,241,0.3);position:relative;overflow:hidden}
.btn::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.2),transparent);transition:left .5s}
.btn:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(99,102,241,0.4)}
.btn:hover::before{left:100%}
.btn:active{transform:translateY(0)}
.btn:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.btn-success{background:linear-gradient(135deg,#10b981,#059669)}
.btn-danger{background:linear-gradient(135deg,#ef4444,#dc2626)}
.input{width:100%;padding:14px 18px;border-radius:14px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);color:var(--text);margin-bottom:12px;font-size:15px;transition:all .3s;font-family:inherit}
.input:focus{outline:none;border-color:var(--accent);background:rgba(255,255,255,0.08);box-shadow:0 0 0 4px rgba(99,102,241,0.1)}
textarea.input{resize:vertical;min-height:120px}
.nav{position:fixed;bottom:0;left:0;right:0;background:rgba(20,20,20,0.95);backdrop-filter:blur(30px);border-top:1px solid rgba(99,102,241,0.2);display:flex;padding:8px 0;z-index:998;box-shadow:0 -4px 24px rgba(0,0,0,0.3)}
.nav-item{flex:1;text-align:center;padding:12px 8px;cursor:pointer;font-size:11px;font-weight:600;transition:all .3s;color:var(--muted);position:relative}
.nav-item:active{transform:scale(0.95)}
.nav-item.active{color:var(--accent)}
.nav-item.active::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:40px;height:3px;background:var(--accent);border-radius:0 0 4px 4px;box-shadow:0 2px 8px rgba(99,102,241,0.5)}
.nav-emoji{display:block;font-size:22px;margin-bottom:4px;transition:transform .3s}
.nav-item:hover .nav-emoji{transform:scale(1.2)}
.task-card{background:linear-gradient(145deg,rgba(30,30,30,0.8),rgba(20,20,20,0.7));border:1px solid rgba(255,255,255,0.08);border-radius:20px;padding:20px;margin-bottom:12px;transition:all .3s}
.task-card:hover{border-color:var(--accent);transform:translateX(4px);box-shadow:0 8px 24px rgba(99,102,241,0.2)}
.task-title{font-size:17px;font-weight:700;margin-bottom:8px}
.task-desc{font-size:14px;color:var(--muted);margin-bottom:12px;line-height:1.6}
.task-price{font-size:20px;font-weight:800;color:var(--success);margin-bottom:12px}
.badge{display:inline-block;padding:6px 12px;border-radius:8px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px}
.badge-rank{background:rgba(99,102,241,0.2);color:#818cf8}
.badge-status{background:rgba(16,185,129,0.2);color:var(--success)}
.chess{display:grid;grid-template-columns:repeat(8,1fr);max-width:360px;aspect-ratio:1;margin:20px auto;border-radius:16px;overflow:hidden;border:4px solid var(--accent);box-shadow:0 12px 40px rgba(99,102,241,0.3)}
.square{aspect-ratio:1;display:flex;align-items:center;justify-content:center;font-size:36px;cursor:pointer;transition:all .2s;user-select:none}
.square.light{background:#f0d9b5}
.square.dark{background:#b58863}
.square.selected{background:#7dd3fc!important;box-shadow:inset 0 0 20px rgba(0,0,0,0.3)}
.square.hint{position:relative}
.square.hint::after{content:'';position:absolute;width:12px;height:12px;background:rgba(16,185,129,0.6);border-radius:50%;box-shadow:0 2px 8px rgba(16,185,129,0.4)}
.diff-btns{display:flex;gap:10px;margin-bottom:20px}
.diff-btn{flex:1;padding:12px;border-radius:12px;border:2px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:var(--text);cursor:pointer;font-weight:600;transition:all .3s}
.diff-btn.active{border-color:var(--accent);background:var(--accent);color:#fff}
.earnings-chart{margin-top:20px;padding:20px;background:rgba(255,255,255,0.03);border-radius:16px}
.history-item{display:flex;justify-content:space-between;align-items:center;padding:16px;background:rgba(255,255,255,0.03);border-radius:12px;margin-bottom:8px;transition:all .3s}
.history-item:hover{background:rgba(255,255,255,0.05);transform:translateX(4px)}
.history-date{font-size:12px;color:var(--muted)}
.history-amount{font-size:18px;font-weight:700;color:var(--success)}
.loading{text-align:center;padding:40px;color:var(--muted)}
.loading::after{content:'...';animation:dots 1.5s infinite}
@keyframes dots{0%,20%{content:''}40%{content:'.'}60%{content:'..'}80%,100%{content:'...'}}
.alert{padding:16px;border-radius:12px;margin-bottom:16px;font-weight:600}
.alert-success{background:rgba(16,185,129,0.2);border:1px solid var(--success);color:var(--success)}
.alert-error{background:rgba(239,68,68,0.2);border:1px solid var(--danger);color:var(--danger)}
.modal{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:none;align-items:center;justify-content:center;z-index:10000}
.modal.active{display:flex}
.modal-content{background:var(--card);border-radius:24px;padding:32px;max-width:400px;width:90%;box-shadow:0 20px 60px rgba(0,0,0,0.5)}
.modal-title{font-size:24px;font-weight:700;margin-bottom:16px}
</style>
</head>
<body>

<!-- Language Selector -->
<div class="lang">
<button onclick="setLang('en')" data-lang="en">üá¨üáß EN</button>
<button onclick="setLang('ru')" data-lang="ru">üá∑üá∫ RU</button>
<button onclick="setLang('no')" data-lang="no">üá≥üá¥ NO</button>
<button onclick="setLang('zh')" data-lang="zh">üá®üá≥ ZH</button>
<button onclick="setLang('es')" data-lang="es">üá™üá∏ ES</button>
<button onclick="setLang('de')" data-lang="de">üá©üá™ DE</button>
</div>

<!-- Header -->
<div class="header">
<div class="greeting" id="greeting">Loading...</div>
<div class="subtitle" id="subtitle">Welcome to 0rkUS Task Platform</div>
</div>

<!-- Stats -->
<div class="stats">
<div class="stat" onclick="showPage('profile')">
<div class="stat-val" id="stat-completed">0</div>
<div class="stat-label" id="lbl-completed">Completed</div>
</div>
<div class="stat" onclick="showPage('earnings')">
<div class="stat-val" id="stat-balance">0‚ÇΩ</div>
<div class="stat-label" id="lbl-balance">Balance</div>
</div>
<div class="stat" onclick="showPage('profile')">
<div class="stat-val" id="stat-rank">Newbie</div>
<div class="stat-label" id="lbl-rank">Rank</div>
</div>
</div>

<!-- Tasks Page -->
<div id="page-tasks" class="page active">
<div class="section-title" id="title-tasks">üìã Available Tasks</div>
<div id="tasks-list" class="loading">Loading tasks</div>
</div>

<!-- Earnings Page -->
<div id="page-earnings" class="page">
<div class="section-title" id="title-earnings">üí∞ Earnings History</div>
<div class="glass">
<div class="earnings-chart">
<canvas id="earningsChart"></canvas>
</div>
</div>
<div class="glass">
<h3 style="margin-bottom:16px;font-size:18px" id="title-recent">Recent Transactions</h3>
<div id="history-list" class="loading">Loading history</div>
</div>
<div class="glass">
<h3 style="margin-bottom:16px;font-size:18px" id="title-monthly">Monthly Report</h3>
<div id="monthly-report" class="loading">Calculating</div>
</div>
</div>

<!-- Profile Page -->
<div id="page-profile" class="page">
<div class="section-title" id="title-profile">üë§ My Profile</div>
<div class="glass">
<div id="profile-info" class="loading">Loading profile</div>
</div>
<div class="glass">
<h3 style="margin-bottom:16px;font-size:18px" id="title-my-tasks">My Tasks</h3>
<div id="my-tasks-list" class="loading">Loading your tasks</div>
</div>
</div>

<!-- Chess Page -->
<div id="page-chess" class="page">
<div class="section-title" id="title-chess">‚ôüÔ∏è Chess Arena</div>
<div class="glass">
<div class="diff-btns">
<button class="diff-btn active" onclick="setDiff(1)" id="diff-1">Easy</button>
<button class="diff-btn" onclick="setDiff(2)" id="diff-2">Medium</button>
<button class="diff-btn" onclick="setDiff(3)" id="diff-3">Hard</button>
</div>
<div class="chess" id="board"></div>
<div style="text-align:center;margin-top:16px;color:var(--muted);font-weight:600" id="chess-status">Select difficulty and start game</div>
<button class="btn" onclick="newGame()" id="btn-new" style="margin-top:16px">üéÆ New Game</button>
</div>
<div class="glass">
<h3 style="margin-bottom:12px;font-size:18px" id="title-elo">ELO Rating</h3>
<div style="font-size:36px;font-weight:800;text-align:center;background:linear-gradient(135deg,#6366f1,#a78bfa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin:20px 0" id="elo-display">400</div>
<div id="chess-history" style="margin-top:20px"></div>
</div>
</div>

<!-- Support Page -->
<div id="page-support" class="page">
<div class="section-title" id="title-support">üÜò Support</div>
<div id="support-alert"></div>
<div class="glass">
<label style="display:block;margin-bottom:12px;font-weight:600;font-size:15px" id="lbl-subject">Subject</label>
<select id="support-subject" class="input">
<option value="task">Task Issue</option>
<option value="payment">Payment Issue</option>
<option value="technical">Technical Problem</option>
<option value="other">Other</option>
</select>
<label style="display:block;margin-bottom:12px;font-weight:600;font-size:15px" id="lbl-message">Your Message</label>
<textarea id="support-msg" class="input" placeholder="Describe your issue in detail..."></textarea>
<button class="btn" onclick="sendSupport()" id="btn-send">üì§ Send Message</button>
</div>
<div class="glass">
<h3 style="margin-bottom:16px;font-size:18px" id="title-my-tickets">My Support Tickets</h3>
<div id="tickets-list" class="loading">Loading your tickets</div>
</div>
</div>

<!-- Navigation -->
<nav class="nav">
<div class="nav-item active" onclick="showPage('tasks')">
<span class="nav-emoji">üìã</span>
<span id="nav-tasks">Tasks</span>
</div>
<div class="nav-item" onclick="showPage('earnings')">
<span class="nav-emoji">üí∞</span>
<span id="nav-earnings">Earnings</span>
</div>
<div class="nav-item" onclick="showPage('profile')">
<span class="nav-emoji">üë§</span>
<span id="nav-profile">Profile</span>
</div>
<div class="nav-item" onclick="showPage('chess')">
<span class="nav-emoji">‚ôüÔ∏è</span>
<span id="nav-chess">Chess</span>
</div>
<div class="nav-item" onclick="showPage('support')">
<span class="nav-emoji">üÜò</span>
<span id="nav-support">Help</span>
</div>
</nav>

<!-- Task Submit Modal -->
<div id="submit-modal" class="modal">
<div class="modal-content">
<div class="modal-title" id="modal-title">Submit Your Work</div>
<textarea id="submit-work" class="input" placeholder="Paste your work URL or description..."></textarea>
<button class="btn btn-success" onclick="submitWork()" id="btn-submit-work">‚úÖ Submit</button>
<button class="btn btn-danger" onclick="closeModal()" style="margin-top:8px">‚ùå Cancel</button>
</div>
</div>

<script>
// ============================================================================
// INITIALIZATION
// ============================================================================
const tg=window.Telegram.WebApp;
tg.ready();
tg.expand();

const user=tg.initDataUnsafe?.user||{};
const userId=user.id||0;
const username=user.first_name||user.username||'User';

// API Configuration - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–® –°–ï–†–í–ï–†!
const API_URL='http://localhost:8080/api'; // Java backend
// –∏–ª–∏
// const API_URL='http://localhost:5000/api'; // Python backend

// Global State
let lang='en';
let chess,selectedSquare,difficulty=1;
let userData={};
let myTasks=[];
let earningsChart;
let currentTaskId=null;

// ============================================================================
// TRANSLATIONS
// ============================================================================
const T={
en:{
greeting:`Hello, ${username}!`,subtitle:'Welcome to 0rkUS Task Platform',
lblCompleted:'Completed',lblBalance:'Balance',lblRank:'Rank',
titleTasks:'üìã Available Tasks',titleEarnings:'üí∞ Earnings History',titleProfile:'üë§ My Profile',
titleChess:'‚ôüÔ∏è Chess Arena',titleSupport:'üÜò Support',titleRecent:'Recent Transactions',
titleMonthly:'Monthly Report',titleElo:'ELO Rating',titleMyTasks:'My Tasks',titleMyTickets:'My Support Tickets',
diff1:'Easy',diff2:'Medium',diff3:'Hard',btnNew:'üéÆ New Game',btnSend:'üì§ Send Message',
lblMessage:'Your Message',lblSubject:'Subject',
navTasks:'Tasks',navEarnings:'Earnings',navProfile:'Profile',navChess:'Chess',navSupport:'Help',
taskTake:'Take Task',taskSubmit:'Submit Work',taskInProgress:'In Progress',
loadingTasks:'Loading tasks...',loadingProfile:'Loading profile...',loadingHistory:'Loading history...',
chessYourTurn:'Your turn',chessThinking:'AI thinking...',chessWin:'You won!',chessDraw:'Draw!',chessLose:'You lost!',
msgSent:'Message sent successfully!',msgError:'Please enter a message',taskTaken:'Task taken successfully!',
workSubmitted:'Work submitted for review!',noTasks:'No tasks available',noTickets:'No support tickets',
modalTitle:'Submit Your Work',btnSubmitWork:'‚úÖ Submit',btnCancel:'‚ùå Cancel'
},
ru:{
greeting:`–ü—Ä–∏–≤–µ—Ç, ${username}!`,subtitle:'–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—É 0rkUS Task',
lblCompleted:'–í—ã–ø–æ–ª–Ω–µ–Ω–æ',lblBalance:'–ë–∞–ª–∞–Ω—Å',lblRank:'–†–∞–Ω–≥',
titleTasks:'üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–¥–∞—á–∏',titleEarnings:'üí∞ –ò—Å—Ç–æ—Ä–∏—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞',titleProfile:'üë§ –ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å',
titleChess:'‚ôüÔ∏è –®–∞—Ö–º–∞—Ç–Ω–∞—è –∞—Ä–µ–Ω–∞',titleSupport:'üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞',titleRecent:'–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏',
titleMonthly:'–ú–µ—Å—è—á–Ω—ã–π –æ—Ç—á—ë—Ç',titleElo:'–†–µ–π—Ç–∏–Ω–≥ ELO',titleMyTasks:'–ú–æ–∏ –∑–∞–¥–∞—á–∏',titleMyTickets:'–ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è',
diff1:'–õ–µ–≥–∫–æ',diff2:'–°—Ä–µ–¥–Ω–µ',diff3:'–°–ª–æ–∂–Ω–æ',btnNew:'üéÆ –ù–æ–≤–∞—è –∏–≥—Ä–∞',btnSend:'üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å',
lblMessage:'–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',lblSubject:'–¢–µ–º–∞',
navTasks:'–ó–∞–¥–∞—á–∏',navEarnings:'–ó–∞—Ä–∞–±–æ—Ç–æ–∫',navProfile:'–ü—Ä–æ—Ñ–∏–ª—å',navChess:'–®–∞—Ö–º–∞—Ç—ã',navSupport:'–ü–æ–º–æ—â—å',
taskTake:'–í–∑—è—Ç—å –∑–∞–¥–∞—á—É',taskSubmit:'–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É',taskInProgress:'–í —Ä–∞–±–æ—Ç–µ',
loadingTasks:'–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á...',loadingProfile:'–ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è...',loadingHistory:'–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...',
chessYourTurn:'–í–∞—à —Ö–æ–¥',chessThinking:'AI –¥—É–º–∞–µ—Ç...',chessWin:'–í—ã –ø–æ–±–µ–¥–∏–ª–∏!',chessDraw:'–ù–∏—á—å—è!',chessLose:'–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!',
msgSent:'–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!',msgError:'–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ',taskTaken:'–ó–∞–¥–∞—á–∞ –≤–∑—è—Ç–∞!',
workSubmitted:'–†–∞–±–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É!',noTasks:'–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞—á',noTickets:'–ù–µ—Ç –æ–±—Ä–∞—â–µ–Ω–∏–π',
modalTitle:'–°–¥–∞—Ç—å —Ä–∞–±–æ—Ç—É',btnSubmitWork:'‚úÖ –°–¥–∞—Ç—å',btnCancel:'‚ùå –û—Ç–º–µ–Ω–∞'
},
no:{
greeting:`Hei, ${username}!`,subtitle:'Velkommen til 0rkUS Task Platform',
lblCompleted:'Fullf√∏rt',lblBalance:'Saldo',lblRank:'Rang',
titleTasks:'üìã Tilgjengelige oppgaver',titleEarnings:'üí∞ Inntektshistorikk',titleProfile:'üë§ Min profil',
titleChess:'‚ôüÔ∏è Sjakkarena',titleSupport:'üÜò St√∏tte',titleRecent:'Nylige transaksjoner',
titleMonthly:'M√•nedlig rapport',titleElo:'ELO-rating',titleMyTasks:'Mine oppgaver',titleMyTickets:'Mine henvendelser',
diff1:'Lett',diff2:'Middels',diff3:'Vanskelig',btnNew:'üéÆ Nytt spill',btnSend:'üì§ Send',
lblMessage:'Din melding',lblSubject:'Emne',
navTasks:'Oppgaver',navEarnings:'Inntekter',navProfile:'Profil',navChess:'Sjakk',navSupport:'Hjelp',
taskTake:'Ta oppgave',taskSubmit:'Send inn arbeid',taskInProgress:'P√•g√•r',
loadingTasks:'Laster oppgaver...',loadingProfile:'Laster profil...',loadingHistory:'Laster historikk...',
chessYourTurn:'Din tur',chessThinking:'AI tenker...',chessWin:'Du vant!',chessDraw:'Uavgjort!',chessLose:'Du tapte!',
msgSent:'Melding sendt!',msgError:'Skriv en melding',taskTaken:'Oppgave tatt!',
workSubmitted:'Arbeid sendt til gjennomgang!',noTasks:'Ingen oppgaver',noTickets:'Ingen henvendelser',
modalTitle:'Send inn arbeid',btnSubmitWork:'‚úÖ Send inn',btnCancel:'‚ùå Avbryt'
},
zh:{
greeting:`‰Ω†Â•ΩÔºå${username}ÔºÅ`,subtitle:'Ê¨¢ËøéÊù•Âà∞ 0rkUS ‰ªªÂä°Âπ≥Âè∞',
lblCompleted:'Â∑≤ÂÆåÊàê',lblBalance:'‰ΩôÈ¢ù',lblRank:'Á≠âÁ∫ß',
titleTasks:'üìã ÂèØÁî®‰ªªÂä°',titleEarnings:'üí∞ Êî∂ÂÖ•ÂéÜÂè≤',titleProfile:'üë§ ÊàëÁöÑËµÑÊñô',
titleChess:'‚ôüÔ∏è ÂõΩÈôÖË±°Ê£ãÁ´ûÊäÄÂú∫',titleSupport:'üÜò ÊîØÊåÅ',titleRecent:'ÊúÄËøë‰∫§Êòì',
titleMonthly:'ÊúàÂ∫¶Êä•Âëä',titleElo:'ELO Á≠âÁ∫ß',titleMyTasks:'ÊàëÁöÑ‰ªªÂä°',titleMyTickets:'ÊàëÁöÑÂ∑•Âçï',
diff1:'ÁÆÄÂçï',diff2:'‰∏≠Á≠â',diff3:'Âõ∞Èöæ',btnNew:'üéÆ Êñ∞Ê∏∏Êàè',btnSend:'üì§ ÂèëÈÄÅ',
lblMessage:'ÊÇ®ÁöÑÊ∂àÊÅØ',lblSubject:'‰∏ªÈ¢ò',
navTasks:'‰ªªÂä°',navEarnings:'Êî∂ÂÖ•',navProfile:'ËµÑÊñô',navChess:'Ë±°Ê£ã',navSupport:'Â∏ÆÂä©',
taskTake:'Êé•Âèó‰ªªÂä°',taskSubmit:'Êèê‰∫§‰ΩúÂìÅ',taskInProgress:'ËøõË°å‰∏≠',
loadingTasks:'Âä†ËΩΩ‰ªªÂä°‰∏≠...',loadingProfile:'Âä†ËΩΩËµÑÊñô‰∏≠...',loadingHistory:'Âä†ËΩΩÂéÜÂè≤‰∏≠...',
chessYourTurn:'‰Ω†ÁöÑÂõûÂêà',chessThinking:'AIÊÄùËÄÉ‰∏≠...',chessWin:'‰Ω†Ëµ¢‰∫ÜÔºÅ',chessDraw:'Âπ≥Â±ÄÔºÅ',chessLose:'‰Ω†Ëæì‰∫ÜÔºÅ',
msgSent:'Ê∂àÊÅØÂ∑≤ÂèëÈÄÅÔºÅ',msgError:'ËØ∑ËæìÂÖ•Ê∂àÊÅØ',taskTaken:'‰ªªÂä°Â∑≤Êé•ÂèóÔºÅ',
workSubmitted:'‰ΩúÂìÅÂ∑≤Êèê‰∫§ÂÆ°Ê†∏ÔºÅ',noTasks:'Êó†ÂèØÁî®‰ªªÂä°',noTickets:'Êó†Â∑•Âçï',
modalTitle:'Êèê‰∫§‰ΩúÂìÅ',btnSubmitWork:'‚úÖ Êèê‰∫§',btnCancel:'‚ùå ÂèñÊ∂à'
},
es:{
greeting:`¬°Hola, ${username}!`,subtitle:'Bienvenido a la plataforma 0rkUS Task',
lblCompleted:'Completado',lblBalance:'Saldo',lblRank:'Rango',
titleTasks:'üìã Tareas disponibles',titleEarnings:'üí∞ Historial de ganancias',titleProfile:'üë§ Mi perfil',
titleChess:'‚ôüÔ∏è Arena de ajedrez',titleSupport:'üÜò Soporte',titleRecent:'Transacciones recientes',
titleMonthly:'Informe mensual',titleElo:'Clasificaci√≥n ELO',titleMyTasks:'Mis tareas',titleMyTickets:'Mis tickets',
diff1:'F√°cil',diff2:'Medio',diff3:'Dif√≠cil',btnNew:'üéÆ Nuevo juego',btnSend:'üì§ Enviar',
lblMessage:'Tu mensaje',lblSubject:'Asunto',
navTasks:'Tareas',navEarnings:'Ganancias',navProfile:'Perfil',navChess:'Ajedrez',navSupport:'Ayuda',
taskTake:'Tomar tarea',taskSubmit:'Enviar trabajo',taskInProgress:'En progreso',
loadingTasks:'Cargando tareas...',loadingProfile:'Cargando perfil...',loadingHistory:'Cargando historial...',
chessYourTurn:'Tu turno',chessThinking:'IA pensando...',chessWin:'¬°Ganaste!',chessDraw:'¬°Empate!',chessLose:'¬°Perdiste!',
msgSent:'¬°Mensaje enviado!',msgError:'Ingresa un mensaje',taskTaken:'¬°Tarea tomada!',
workSubmitted:'¬°Trabajo enviado a revisi√≥n!',noTasks:'Sin tareas',noTickets:'Sin tickets',
modalTitle:'Enviar trabajo',btnSubmitWork:'‚úÖ Enviar',btnCancel:'‚ùå Cancelar'
},
de:{
greeting:`Hallo, ${username}!`,subtitle:'Willkommen bei 0rkUS Task Platform',
lblCompleted:'Abgeschlossen',lblBalance:'Guthaben',lblRank:'Rang',
titleTasks:'üìã Verf√ºgbare Aufgaben',titleEarnings:'üí∞ Einkommenshistorie',titleProfile:'üë§ Mein Profil',
titleChess:'‚ôüÔ∏è Schach-Arena',titleSupport:'üÜò Unterst√ºtzung',titleRecent:'Letzte Transaktionen',
titleMonthly:'Monatsbericht',titleElo:'ELO-Bewertung',titleMyTasks:'Meine Aufgaben',titleMyTickets:'Meine Tickets',
diff1:'Einfach',diff2:'Mittel',diff3:'Schwer',btnNew:'üéÆ Neues Spiel',btnSend:'üì§ Senden',
lblMessage:'Deine Nachricht',lblSubject:'Betreff',
navTasks:'Aufgaben',navEarnings:'Einnahmen',navProfile:'Profil',navChess:'Schach',navSupport:'Hilfe',
taskTake:'Aufgabe nehmen',taskSubmit:'Arbeit einreichen',taskInProgress:'In Bearbeitung',
loadingTasks:'Lade Aufgaben...',loadingProfile:'Lade Profil...',loadingHistory:'Lade Historie...',
chessYourTurn:'Dein Zug',chessThinking:'KI denkt...',chessWin:'Du hast gewonnen!',chessDraw:'Unentschieden!',chessLose:'Du hast verloren!',
msgSent:'Nachricht gesendet!',msgError:'Gib eine Nachricht ein',taskTaken:'Aufgabe genommen!',
workSubmitted:'Arbeit zur Pr√ºfung eingereicht!',noTasks:'Keine Aufgaben',noTickets:'Keine Tickets',
modalTitle:'Arbeit einreichen',btnSubmitWork:'‚úÖ Einreichen',btnCancel:'‚ùå Abbrechen'
}
};

// ============================================================================
// LANGUAGE FUNCTIONS
// ============================================================================
function setLang(l){
lang=l;
setCookie('orkus_lang',l,365);
updateUI();
document.querySelectorAll('.lang button').forEach(b=>b.classList.toggle('active',b.dataset.lang===l));
// –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
api('/user/set_language',{language:l}).catch(e=>console.error('Lang update error:',e));
}

function updateUI(){
const t=T[lang];
document.getElementById('greeting').textContent=t.greeting;
document.getElementById('subtitle').textContent=t.subtitle;
document.getElementById('lbl-completed').textContent=t.lblCompleted;
document.getElementById('lbl-balance').textContent=t.lblBalance;
document.getElementById('lbl-rank').textContent=t.lblRank;
document.getElementById('title-tasks').textContent=t.titleTasks;
document.getElementById('title-earnings').textContent=t.titleEarnings;
document.getElementById('title-profile').textContent=t.titleProfile;
document.getElementById('title-chess').textContent=t.titleChess;
document.getElementById('title-support').textContent=t.titleSupport;
document.getElementById('title-recent').textContent=t.titleRecent;
document.getElementById('title-monthly').textContent=t.titleMonthly;
document.getElementById('title-elo').textContent=t.titleElo;
document.getElementById('title-my-tasks').textContent=t.titleMyTasks;
document.getElementById('title-my-tickets').textContent=t.titleMyTickets;
document.getElementById('diff-1').textContent=t.diff1;
document.getElementById('diff-2').textContent=t.diff2;
document.getElementById('diff-3').textContent=t.diff3;
document.getElementById('btn-new').textContent=t.btnNew;
document.getElementById('btn-send').textContent=t.btnSend;
document.getElementById('lbl-message').textContent=t.lblMessage;
document.getElementById('lbl-subject').textContent=t.lblSubject;
document.getElementById('nav-tasks').textContent=t.navTasks;
document.getElementById('nav-earnings').textContent=t.navEarnings;
document.getElementById('nav-profile').textContent=t.navProfile;
document.getElementById('nav-chess').textContent=t.navChess;
document.getElementById('nav-support').textContent=t.navSupport;
document.getElementById('modal-title').textContent=t.modalTitle;
document.getElementById('btn-submit-work').textContent=t.btnSubmitWork;
}

// ============================================================================
// COOKIE FUNCTIONS
// ============================================================================
function setCookie(n,v,days){
const d=new Date();
d.setTime(d.getTime()+(days*24*60*60*1000));
document.cookie=n+"="+v+";expires="+d.toUTCString()+";path=/;SameSite=None;Secure";
}

function getCookie(n){
const v=document.cookie.match('(^|;)\\s*'+n+'\\s*=\\s*([^;]+)');
return v?v.pop():'';
}

// ============================================================================
// API FUNCTIONS
// ============================================================================
async function api(endpoint,data={},method='POST'){
try{
const options={
method,
headers:{'Content-Type':'application/json'},
credentials:'include'
};
if(method==='POST'){
options.body=JSON.stringify({
...data,
telegram_id:userId,
username:user.username||username,
first_name:username
});
}
const res=await fetch(API_URL+endpoint,options);
if(!res.ok)throw new Error(`HTTP ${res.status}`);
return await res.json();
}catch(e){
console.error('API Error:',endpoint,e);
showAlert('Connection error. Please check your internet.','error');
return{error:e.message};
}
}

function showAlert(msg,type='success'){
const alert=document.createElement('div');
alert.className=`alert alert-${type}`;
alert.textContent=msg;
alert.style.animation='fadeIn 0.3s';
document.getElementById('support-alert').appendChild(alert);
setTimeout(()=>{
alert.style.animation='fadeOut 0.3s';
setTimeout(()=>alert.remove(),300);
},3000);
}

// ============================================================================
// DATA LOADING FUNCTIONS
// ============================================================================
async function loadProfile(){
const d=await api('/user/profile');
if(d&&!d.error){
userData=d;
document.getElementById('stat-completed').textContent=d.completed_tasks||0;
document.getElementById('stat-balance').textContent=(d.balance||0).toFixed(2)+'‚ÇΩ';
document.getElementById('stat-rank').textContent=d.rank||'Newbie';
document.getElementById('elo-display').textContent=d.chess_elo||400;
document.getElementById('profile-info').innerHTML=`
<div style="margin-bottom:24px;text-align:center">
<div style="width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,#6366f1,#a78bfa);display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 16px">üë§</div>
<div style="font-size:22px;font-weight:700;margin-bottom:4px">${d.username||username}</div>
<div style="color:var(--muted)">${d.first_name||''}</div>
</div>
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:24px">
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px">${T[lang].lblRank}</div>
<div style="font-size:20px;font-weight:700">${d.rank||'Newbie'}</div>
</div>
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px">${T[lang].lblCompleted}</div>
<div style="font-size:20px;font-weight:700">${d.completed_tasks||0}</div>
</div>
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px">${T[lang].lblBalance}</div>
<div style="font-size:20px;font-weight:700;color:var(--success)">${(d.balance||0).toFixed(2)}‚ÇΩ</div>
</div>
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px">Warnings</div>
<div style="font-size:20px;font-weight:700;color:${d.warnings>2?'var(--danger)':'var(--success)'}">${d.warnings||0}/5</div>
</div>
</div>
`;
}
loadMyTasks();
}

async function loadTasks(){
const d=await api('/tasks/list');
const list=document.getElementById('tasks-list');
if(d&&d.tasks&&d.tasks.length>0){
list.innerHTML='';
d.tasks.forEach(t=>{
const card=document.createElement('div');
card.className='task-card';
card.innerHTML=`
<div class="task-title">${t.title}</div>
<div class="task-desc">${t.description}</div>
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<div class="task-price">${t.price}‚ÇΩ</div>
<span class="badge badge-rank">${t.min_rank||'Newbie'}</span>
</div>
<button class="btn" onclick="takeTask(${t.id})">${T[lang].taskTake}</button>
`;
list.appendChild(card);
});
}else{
list.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">${T[lang].noTasks}</div>`;
}
}

async function loadMyTasks(){
const d=await api('/user/my_tasks');
const list=document.getElementById('my-tasks-list');
if(d&&d.tasks&&d.tasks.length>0){
myTasks=d.tasks;
list.innerHTML='';
d.tasks.forEach(t=>{
const card=document.createElement('div');
card.className='task-card';
const statusColor=t.status==='approved'?'var(--success)':t.status==='rejected'?'var(--danger)':'#f59e0b';
card.innerHTML=`
<div class="task-title">${t.task_title}</div>
<div style="margin-bottom:12px">
<span class="badge badge-status" style="background:rgba(245,158,11,0.2);color:#f59e0b">${t.status}</span>
</div>
${t.status==='in_progress'?`<button class="btn btn-success" onclick="openSubmitModal(${t.id})">${T[lang].taskSubmit}</button>`:''}
${t.status==='rejected'&&t.admin_comment?`<div style="margin-top:12px;padding:12px;background:rgba(239,68,68,0.1);border-radius:8px;color:var(--danger)">‚ùå ${t.admin_comment}</div>`:''}
${t.status==='approved'?`<div style="margin-top:12px;padding:12px;background:rgba(16,185,129,0.1);border-radius:8px;color:var(--success)">‚úÖ Approved! +${t.price}‚ÇΩ</div>`:''}
`;
list.appendChild(card);
});
}else{
list.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">No tasks in progress</div>`;
}
}

async function loadEarnings(){
const d=await api('/user/earnings_history');
if(d&&d.history&&d.history.length>0){
// History List
const list=document.getElementById('history-list');
list.innerHTML='';
d.history.slice(0,10).forEach(h=>{
const item=document.createElement('div');
item.className='history-item';
item.innerHTML=`
<div>
<div style="font-weight:600">${h.description}</div>
<div class="history-date">${new Date(h.created_at).toLocaleDateString()}</div>
</div>
<div class="history-amount">+${h.amount}‚ÇΩ</div>
`;
list.appendChild(item);
});

// Chart
const ctx=document.getElementById('earningsChart');
if(earningsChart)earningsChart.destroy();
const labels=d.history.slice(0,7).reverse().map(h=>new Date(h.created_at).toLocaleDateString());
const data=d.history.slice(0,7).reverse().map(h=>h.amount);
earningsChart=new Chart(ctx,{
type:'line',
data:{
labels,
datasets:[{
label:'Earnings',
data,
borderColor:'#6366f1',
backgroundColor:'rgba(99,102,241,0.1)',
fill:true,
tension:0.4,
borderWidth:3
}]
},
options:{
responsive:true,
maintainAspectRatio:true,
plugins:{legend:{display:false}},
scales:{
y:{beginAtZero:true,grid:{color:'rgba(255,255,255,0.05)'},ticks:{color:'#666'}},
x:{grid:{display:false},ticks:{color:'#666'}}
}
}
});
}else{
document.getElementById('history-list').innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">No earnings yet</div>`;
}

// Monthly Report
if(d&&d.monthly){
const report=document.getElementById('monthly-report');
report.innerHTML=`
<div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px;text-transform:uppercase">This Month</div>
<div style="font-size:24px;font-weight:700;color:var(--success)">${d.monthly.current||0}‚ÇΩ</div>
</div>
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px;text-transform:uppercase">Last Month</div>
<div style="font-size:24px;font-weight:700">${d.monthly.previous||0}‚ÇΩ</div>
</div>
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px;text-transform:uppercase">Total Tasks</div>
<div style="font-size:24px;font-weight:700">${d.monthly.tasks||0}</div>
</div>
<div style="padding:16px;background:rgba(255,255,255,0.03);border-radius:12px">
<div style="color:var(--muted);font-size:12px;margin-bottom:4px;text-transform:uppercase">Average</div>
<div style="font-size:24px;font-weight:700">${d.monthly.average||0}‚ÇΩ</div>
</div>
</div>
`;
}else{
document.getElementById('monthly-report').innerHTML=`<div style="text-align:center;padding:20px;color:var(--muted)">No data for report</div>`;
}
}

async function loadTickets(){
const d=await api('/support/my_tickets');
const list=document.getElementById('tickets-list');
if(d&&d.tickets&&d.tickets.length>0){
list.innerHTML='';
d.tickets.forEach(t=>{
const card=document.createElement('div');
card.className='task-card';
const statusColor=t.status==='resolved'?'var(--success)':t.status==='closed'?'var(--muted)':'#f59e0b';
card.innerHTML=`
<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
<div style="font-weight:700">Ticket #${t.id}</div>
<span class="badge" style="background:rgba(245,158,11,0.2);color:#f59e0b">${t.status}</span>
</div>
<div style="color:var(--muted);font-size:13px;margin-bottom:8px">${new Date(t.created_at).toLocaleString()}</div>
<div style="margin-bottom:12px">${t.message}</div>
${t.admin_reply?`<div style="padding:12px;background:rgba(99,102,241,0.1);border-radius:8px;border-left:3px solid var(--accent)"><strong>Admin:</strong> ${t.admin_reply}</div>`:''}
`;
list.appendChild(card);
});
}else{
list.innerHTML=`<div style="text-align:center;padding:40px;color:var(--muted)">${T[lang].noTickets}</div>`;
}
}

// ============================================================================
// TASK FUNCTIONS
// ============================================================================
async function takeTask(id){
const btn=event.target;
btn.disabled=true;
btn.textContent='Loading...';
const d=await api('/tasks/take',{task_id:id});
if(d&&d.success){
showAlert(T[lang].taskTaken,'success');
loadTasks();
loadMyTasks();
}else{
btn.disabled=false;
btn.textContent=T[lang].taskTake;
showAlert(d.error||'Error taking task','error');
}
}

function openSubmitModal(taskId){
currentTaskId=taskId;
document.getElementById('submit-modal').classList.add('active');
document.getElementById('submit-work').value='';
document.getElementById('submit-work').focus();
}

function closeModal(){
document.getElementById('submit-modal').classList.remove('active');
currentTaskId=null;
}

async function submitWork(){
const work=document.getElementById('submit-work').value.trim();
if(!work){
showAlert('Please enter your work URL or description','error');
return;
}
const btn=document.getElementById('btn-submit-work');
btn.disabled=true;
btn.textContent='Submitting...';
const d=await api('/tasks/submit',{assignment_id:currentTaskId,work});
if(d&&d.success){
showAlert(T[lang].workSubmitted,'success');
closeModal();
loadMyTasks();
}else{
showAlert(d.error||'Error submitting work','error');
}
btn.disabled=false;
btn.textContent=T[lang].btnSubmitWork;
}

// ============================================================================
// SUPPORT FUNCTIONS
// ============================================================================
async function sendSupport(){
const subject=document.getElementById('support-subject').value;
const msg=document.getElementById('support-msg').value.trim();
if(!msg){
showAlert(T[lang].msgError,'error');
return;
}
const btn=document.getElementById('btn-send');
btn.disabled=true;
btn.textContent='Sending...';
const d=await api('/support/send',{subject,message:msg});
if(d&&d.success){
showAlert(T[lang].msgSent,'success');
document.getElementById('support-msg').value='';
loadTickets();
}else{
showAlert(d.error||'Error sending message','error');
}
btn.disabled=false;
btn.textContent=T[lang].btnSend;
}

// ============================================================================
// CHESS FUNCTIONS
// ============================================================================
function setDiff(d){
difficulty=d;
document.querySelectorAll('.diff-btn').forEach((b,i)=>b.classList.toggle('active',i+1===d));
}

function newGame(){
chess=new Chess();
selectedSquare=null;
renderBoard();
document.getElementById('chess-status').textContent=T[lang].chessYourTurn;
}

function renderBoard(){
if(!chess)return;
const b=document.getElementById('board');
b.innerHTML='';
const board=chess.board();
for(let r=0;r<8;r++){
for(let c=0;c<8;c++){
const sq=document.createElement('div');
const sqName=String.fromCharCode(97+c)+(8-r);
sq.className='square '+((r+c)%2===0?'light':'dark');
if(selectedSquare===sqName)sq.classList.add('selected');
const piece=board[r][c];
if(piece){
const symbols={p:'‚ôü',r:'‚ôú',n:'‚ôû',b:'‚ôù',q:'‚ôõ',k:'‚ôö',P:'‚ôô',R:'‚ôñ',N:'‚ôò',B:'‚ôó',Q:'‚ôï',K:'‚ôî'};
sq.textContent=symbols[piece.type.toUpperCase()+(piece.color==='w'?'P':'')]||symbols[piece.type];
}
if(selectedSquare){
const moves=chess.moves({square:selectedSquare,verbose:true});
if(moves.find(m=>m.to===sqName))sq.classList.add('hint');
}
sq.onclick=()=>clickSquare(sqName);
b.appendChild(sq);
}
}
}

function clickSquare(sq){
if(!chess)return;
if(!selectedSquare){
const moves=chess.moves({square:sq,verbose:true});
if(moves.length>0){
selectedSquare=sq;
renderBoard();
}
}else{
const move=chess.move({from:selectedSquare,to:sq,promotion:'q'});
if(move){
selectedSquare=null;
renderBoard();
if(!chess.game_over()){
document.getElementById('chess-status').textContent=T[lang].chessThinking;
setTimeout(aiMove,500);
}else{
endGame();
}
}else{
selectedSquare=null;
clickSquare(sq);
}
}
}

function aiMove(){
const moves=chess.moves({verbose:true});
if(moves.length>0){
let move;
if(difficulty===3){
move=getBestMove();
}else if(difficulty===2){
const captures=moves.filter(m=>m.captured);
move=captures.length>0?captures[Math.floor(Math.random()*captures.length)]:moves[Math.floor(Math.random()*moves.length)];
}else{
move=moves[Math.floor(Math.random()*moves.length)];
}
chess.move(move);
renderBoard();
if(chess.game_over()){
endGame();
}else{
document.getElementById('chess-status').textContent=T[lang].chessYourTurn;
}
}
}

function getBestMove(){
const moves=chess.moves({verbose:true});
let bestMove=moves[0];
let bestValue=-9999;
moves.forEach(m=>{
chess.move(m);
const value=-evaluate();
chess.undo();
if(value>bestValue){
bestValue=value;
bestMove=m;
}
});
return bestMove;
}

function evaluate(){
const board=chess.board();
let value=0;
const values={p:1,n:3,b:3,r:5,q:9,k:0};
for(let r=0;r<8;r++){
for(let c=0;c<8;c++){
const piece=board[r][c];
if(piece){
const v=values[piece.type]||0;
value+=piece.color==='w'?v:-v;
}
}
}
return value;
}

async function endGame(){
let result,eloChange;
if(chess.in_checkmate()){
result=chess.turn()==='b'?'win':'lose';
eloChange=result==='win'?difficulty*30:-difficulty*20;
}else{
result='draw';
eloChange=5;
}
const msg=result==='win'?T[lang].chessWin:result==='draw'?T[lang].chessDraw:T[lang].chessLose;
document.getElementById('chess-status').textContent=msg+' ('+(eloChange>0?'+':'')+eloChange+' ELO)';
await api('/chess/save_game',{difficulty,result,elo_change:eloChange,moves:chess.history()});
loadProfile();
}

// ============================================================================
// NAVIGATION
// ============================================================================
function showPage(p){
document.querySelectorAll('.page').forEach(e=>e.classList.remove('active'));
document.getElementById('page-'+p).classList.add('active');
document.querySelectorAll('.nav-item').forEach(e=>e.classList.remove('active'));
if(event&&event.target){
const nav=event.target.closest('.nav-item');
if(nav)nav.classList.add('active');
}else{
document.querySelectorAll('.nav-item').forEach((e,i)=>{
if(['tasks','earnings','profile','chess','support'][i]===p)e.classList.add('active');
});
}
if(p==='tasks')loadTasks();
if(p==='earnings')loadEarnings();
if(p==='profile')loadProfile();
if(p==='support')loadTickets();
}

// ============================================================================
// INITIALIZATION
// ============================================================================
const savedLang=getCookie('orkus_lang')||'en';
setLang(savedLang);
loadProfile();
loadTasks();

console.log('‚úÖ 0rkUS Task - All functions loaded');
console.log('üìä User ID:',userId);
console.log('üåê Language:',lang);
console.log('üîó API:',API_URL);
</script>
</body>
</html>
